<?php
session_start();
require "db.php";

$error = "";

if ($_SERVER['REQUEST_METHOD'] === 'POST') {

    $email = trim($_POST['email']);
    $pass  = $_POST['password'];

    if ($email === "" || $pass === "") {
        $error = "Both fields are required!";
    } else {
        $stmt = $conn->prepare("SELECT email, username, password FROM users WHERE email=?");
        $stmt->bind_param("s", $email);
        $stmt->execute();
        $stmt->store_result();

        if ($stmt->num_rows === 1) {
            $stmt->bind_result($dbEmail, $dbUser, $dbPass);
            $stmt->fetch();

            if (password_verify($pass, $dbPass)) {
                $_SESSION['user_id'] = $dbEmail;
                $_SESSION['username'] = $dbUser;
                header("Location: index.php");
                exit;
            } else {
                $error = "Incorrect password!";
            }

        } else {
            $error = "Email not registered!";
        }
        $stmt->close();
    }
}
?>
<!DOCTYPE html>
<html>
<head>
    <title>Login - FarmEx Tracker</title>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Poppins,Arial,sans-serif;}

body{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(135deg,#e8f5e9,#c8e6c9,#a5d6a7);
}

.auth-wrapper{
    width:100%;
    max-width:380px;
    padding:20px;
}

.glass-card{
    background:rgba(255,255,255,0.55);
    border-radius:18px;
    padding:22px 20px;
    border:1px solid rgba(255,255,255,0.7);
    box-shadow:0 8px 25px rgba(0,0,0,0.15);
    backdrop-filter:blur(16px);
    animation:pop 0.4s ease;
}

@keyframes pop{
    from{transform:scale(0.95);opacity:0;}
    to{transform:scale(1);opacity:1;}
}

.logo{
    text-align:center;
    font-size:24px;
    font-weight:700;
    background:linear-gradient(120deg,#2e7d32,#66bb6a);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    margin-bottom:6px;
    letter-spacing:1px;
}

.subtitle{
    text-align:center;
    color:#4b6352;
    font-size:13px;
    margin-bottom:16px;
}

label{
    display:block;
    font-size:13px;
    color:#2e4233;
    margin-top:8px;
    font-weight:500;
}

input{
    width:100%;
    padding:9px;
    margin-top:4px;
    border-radius:10px;
    border:1px solid rgba(0,0,0,0.15);
    background:rgba(255,255,255,0.75);
    color:#1b1b1b;
    font-size:14px;
}

input::placeholder{
    color:rgba(0,0,0,0.5);
}

input:focus{
    outline:none;
    border-color:#66bb6a;
    background:#ffffff;
}

.btn{
    width:100%;
    margin-top:16px;
    padding:10px;
    border:none;
    border-radius:999px;
    background:linear-gradient(120deg,#43a047,#66bb6a);
    color:white;
    font-size:14px;
    font-weight:600;
    cursor:pointer;
}

.btn:hover{
    background:linear-gradient(120deg,#2e7d32,#43a047);
}

.error{
    text-align:center;
    background:rgba(255,0,0,0.12);
    color:#b71c1c;
    padding:8px 10px;
    font-size:13px;
    border-radius:8px;
    border:1px solid rgba(255,0,0,0.25);
    margin-bottom:10px;
}

.info{
    text-align:center;
    background:rgba(76,175,80,0.15);
    color:#1b5e20;
    padding:8px 10px;
    font-size:13px;
    border-radius:8px;
    border:1px solid rgba(76,175,80,0.3);
    margin-bottom:10px;
}

.bottom-text{
    text-align:center;
    margin-top:12px;
    font-size:13px;
    color:#2e4233;
}

.bottom-text a{
    color:#1b5e20;
    text-decoration:none;
    font-weight:600;
}
</style>
</head>

<body>

<div class="auth-wrapper">
    <div class="glass-card">

        <h2 class="logo">&#127793; FarmEx Tracker</h2>
        <div class="subtitle">Login to manage your farm</div>

        <?php if(isset($_GET['success'])): ?>
            <div class="info">Registration successful! Please login.</div>
        <?php endif; ?>

        <?php if($error != ""): ?>
            <div class="error"><?= htmlspecialchars($error) ?></div>
        <?php endif; ?>

        <form method="post">

            <label>Email</label>
            <input type="email" name="email" required>

            <label>Password</label>
            <input type="password" name="password" required>

            <button class="btn">Login</button>
        </form>

        <div class="bottom-text">
            New user? <a href="register.php">Create account</a>
        </div>

    </div>
</div>

</body>
</html>
